SET(ZSTD_DICTIONARY_C_FILES)

FIND_PROGRAM(RESOURCE_COMPILER xxd)
FOREACH(DICTIONARY_NUM RANGE 62)
  STRING(LENGTH "${DICTIONARY_NUM}" DICTIONARY_NUM_LEN)
  MATH(EXPR LEADING_ZEROS_NEEDED "2 - ${DICTIONARY_NUM_LEN}")
  SET(DICTIONARY_NUM_STRING "${DICTIONARY_NUM}")
  FOREACH(DUMMY RANGE ${LEADING_ZEROS_NEEDED})
    SET(DICTIONARY_NUM_STRING "0${DICTIONARY_NUM_STRING}")
  ENDFOREACH()
  SET(ZSTD_DICTIONARY_SOURCE_FILENAME "${DICTIONARY_NUM_STRING}M.dict.zst")
  MESSAGE("Looking at ${DICTIONARY_NUM_STRING}")
  SET(ZSTD_DICTIONARY_C_FILENAME "${DICTIONARY_NUM_STRING}M.c")
  LIST(APPEND ZSTD_DICTIONARY_C_FILES ${ZSTD_DICTIONARY_C_FILENAME})
  ADD_CUSTOM_COMMAND(OUTPUT ${ZSTD_DICTIONARY_C_FILENAME}
                     DEPENDS ${ZSTD_DICTIONARY_SOURCE_FILENAME}
                     WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
                     COMMAND ${RESOURCE_COMPILER} -i ${ZSTD_DICTIONARY_SOURCE_FILENAME} ${CMAKE_CURRENT_BINARY_DIR}/${ZSTD_DICTIONARY_C_FILENAME}
                     COMMENT "Compiling ${ZSTD_DICTIONARY_SOURCE_FILENAME} to .c")
ENDFOREACH()

add_library( hive_chain_zstd_dictionaries
             ${ZSTD_DICTIONARY_C_FILES} )

if( CLANG_TIDY_EXE )
   set_target_properties(
      hive_chain_zstd_dictionaries PROPERTIES
      CXX_CLANG_TIDY "${DO_CLANG_TIDY}"
   )
endif( CLANG_TIDY_EXE )

INSTALL( TARGETS
   hive_chain_zstd_dictionaries

   RUNTIME DESTINATION bin
   LIBRARY DESTINATION lib
   ARCHIVE DESTINATION lib
)
