variables: 
  # Variables required by Common CI jobs
  CI_COMMON_JOB_VERSION: "0a8b4a4d6098c3e4087a58a61622ffb0817ecb39"
  DOCKER_BUILDER_TAG: "$CI_COMMON_JOB_VERSION"
  DOCKER_DIND_TAG: "$CI_COMMON_JOB_VERSION"
  IMAGE_REMOVER_TAG: "$CI_COMMON_JOB_VERSION"

include:
  - project: 'hive/common-ci-configuration'
    ref: 0a8b4a4d6098c3e4087a58a61622ffb0817ecb39
    file: '/templates/docker_image_jobs.gitlab-ci.yml'

.docker_image_builder_job:
  extends: .docker_image_builder_job_template
  variables:
    FF_NETWORK_PER_BUILD: "true"

.docker_image_cleanup_job:
  extends: .docker_image_cleanup_job_template

.prepare_hived_data_5m_image:
  extends: .docker_image_builder_job

  variables:
    SUBMODULE_DIR: "$CI_PROJECT_DIR"
    REGISTRY_USER: "$CI_IMG_BUILDER_USER"
    REGISTRY_PASS: $CI_IMG_BUILDER_PASSWORD

    SCRIPTS_PATH: "$SUBMODULE_DIR/scripts"
  script:
    - $SCRIPTS_PATH/ci-helpers/get_image4submodule.sh "$SUBMODULE_DIR" registry.gitlab.syncad.com/hive/hive/ "HIVED_IMAGE_NAME" "$REGISTRY_USER" "$REGISTRY_PASS" "hived-mainnet-binaries" $CI_COMMIT_REF_SLUG
    - ls -la ./hived-mainnet-binaries/*

  artifacts:
    reports:
      dotenv: docker_image_name.env
    paths:
      - ./hived-mainnet-binaries/*
    expire_in: 6 hours

